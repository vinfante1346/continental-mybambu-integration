<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bambu Pay 2.0 Monthly Tracker - 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            color: #667eea;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }

        .nav-tab {
            padding: 12px 30px;
            background: #e0e7ff;
            color: #667eea;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .nav-tab:hover {
            background: #667eea;
            color: white;
        }

        .nav-tab.active {
            background: #667eea;
            color: white;
        }

        .week-selector {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .week-selector select {
            padding: 10px;
            font-size: 1.1em;
            border: 2px solid #667eea;
            border-radius: 5px;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }

        .metric:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .metric label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .metric input {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 5px;
            transition: border-color 0.3s;
        }

        .metric input:focus {
            outline: none;
            border-color: #667eea;
        }

        .metric input:read-only {
            background: #e9ecef;
            cursor: not-allowed;
        }

        .metric .target {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .summary-card .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .button {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .button.secondary {
            background: #6b7280;
        }

        .button.success {
            background: #10b981;
        }

        .actions {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1em;
            min-height: 120px;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .saving-pulse {
            animation: pulse 1s ease-in-out infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Bambu Pay 2.0 Monthly Tracker</h1>
            <p style="font-size: 1.2em; color: #666; margin-top: 10px;">TabaPay Monthly Performance Analytics</p>

            <div class="nav-tabs">
                <a href="Bambu_Pay_Tracker.html" class="nav-tab">Daily</a>
                <a href="Bambu_Pay_Weekly_Tracker.html" class="nav-tab">Weekly</a>
                <a href="Bambu_Pay_Monthly_Tracker.html" class="nav-tab active">Monthly</a>
            </div>
        </div>

        <div class="week-selector">
            <div>
                <label for="monthSelect"><strong>Select Month:</strong></label>
                <select id="monthSelect" onchange="updateMonthDates()">
                    <option value="1">January 2025</option>
                    <option value="2">February 2025</option>
                    <option value="3">March 2025</option>
                    <option value="4">April 2025</option>
                    <option value="5">May 2025</option>
                    <option value="6">June 2025</option>
                    <option value="7">July 2025</option>
                    <option value="8">August 2025</option>
                    <option value="9">September 2025</option>
                    <option value="10">October 2025</option>
                    <option value="11" selected>November 2025</option>
                    <option value="12">December 2025</option>
                </select>
            </div>
            <div style="color: #666;">
                <strong id="monthDates">November 2025</strong> | 30 Days
            </div>
        </div>

        <!-- Monthly Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card">
                <div class="label">Monthly Transactions</div>
                <div class="value" id="summary_txns">0</div>
            </div>
            <div class="summary-card">
                <div class="label">Avg Success Rate</div>
                <div class="value" id="summary_success">0%</div>
            </div>
            <div class="summary-card">
                <div class="label">Monthly Volume</div>
                <div class="value" id="summary_volume">$0</div>
            </div>
            <div class="summary-card">
                <div class="label">Monthly Revenue</div>
                <div class="value" id="summary_revenue">$0</div>
            </div>
        </div>

        <!-- Monthly Performance -->
        <div class="section">
            <h2>üìà Monthly Performance Summary</h2>
            <div class="metrics-grid">
                <div class="metric">
                    <label>Total Monthly Transactions</label>
                    <input type="number" id="total_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Sum of all daily transactions</div>
                </div>

                <div class="metric">
                    <label>Total Successful Transactions</label>
                    <input type="number" id="successful_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Sum of successful transactions</div>
                </div>

                <div class="metric">
                    <label>Average Daily Transactions</label>
                    <input type="number" id="avg_daily_txns" placeholder="0" step="0.1" readonly>
                    <div class="target">Monthly total / 30 days</div>
                </div>

                <div class="metric">
                    <label>Monthly Success Rate %</label>
                    <input type="number" id="success_rate" placeholder="0" step="0.01" readonly>
                    <div class="target">Average success across week</div>
                </div>

                <div class="metric">
                    <label>Total Monthly Volume</label>
                    <input type="number" id="total_volume" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Sum of transaction volume</div>
                </div>

                <div class="metric">
                    <label>Average Transaction Size</label>
                    <input type="number" id="avg_txn_size" placeholder="0" step="0.01" readonly>
                    <div class="target">Volume / successful transactions</div>
                </div>

                <div class="metric">
                    <label>Total Platform Revenue</label>
                    <input type="number" id="platform_revenue" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Sum of daily platform fees</div>
                </div>

                <div class="metric">
                    <label>Total Errors</label>
                    <input type="number" id="total_errors" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Sum of monthly errors</div>
                </div>
            </div>
        </div>

        <!-- Monthly Growth -->
        <div class="section">
            <h2>üöÄ Monthly Growth Metrics</h2>
            <div class="metrics-grid">
                <div class="metric">
                    <label>Total Portal Opt-Ins</label>
                    <input type="number" id="portal_optins" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Sum of daily portal opt-ins</div>
                </div>

                <div class="metric">
                    <label>Total Bambu Pay Opt-Ins</label>
                    <input type="number" id="bambupay_optins" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Sum of daily Bambu Pay opt-ins</div>
                </div>

                <div class="metric">
                    <label>Total Monthly Opt-Ins</label>
                    <input type="number" id="total_optins" placeholder="0" readonly>
                    <div class="target">Portal + Bambu Pay</div>
                </div>

                <div class="metric">
                    <label>Average Daily Opt-Ins</label>
                    <input type="number" id="avg_daily_optins" placeholder="0" step="0.1" readonly>
                    <div class="target">Monthly total / 30 days</div>
                </div>

                <div class="metric">
                    <label>Month-over-Month Growth %</label>
                    <input type="number" id="mom_growth" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">vs previous month</div>
                </div>

                <div class="metric">
                    <label>New Active Users (Monthly)</label>
                    <input type="number" id="new_users" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Unique new users this month</div>
                </div>
            </div>
        </div>

        <!-- Card Type Performance -->
        <div class="section">
            <h2>üí≥ Monthly Card Type Performance</h2>
            <div class="metrics-grid">
                <div class="metric">
                    <label>Debit Transactions</label>
                    <input type="number" id="debit_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Sum of monthly debit txns</div>
                </div>

                <div class="metric">
                    <label>Debit Success Rate %</label>
                    <input type="number" id="debit_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Average monthly debit success</div>
                </div>

                <div class="metric">
                    <label>Credit Transactions</label>
                    <input type="number" id="credit_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Sum of monthly credit txns</div>
                </div>

                <div class="metric">
                    <label>Credit Success Rate %</label>
                    <input type="number" id="credit_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Average monthly credit success</div>
                </div>

                <div class="metric">
                    <label>Prepaid Transactions</label>
                    <input type="number" id="prepaid_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Sum of monthly prepaid txns</div>
                </div>

                <div class="metric">
                    <label>Prepaid Success Rate %</label>
                    <input type="number" id="prepaid_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Average monthly prepaid success</div>
                </div>
            </div>
        </div>

        <!-- Error Analysis -->
        <div class="section">
            <h2>‚ö†Ô∏è Monthly Error Summary</h2>
            <div class="metrics-grid">
                <div class="metric">
                    <label>NSF Errors (Code 51)</label>
                    <input type="number" id="nsf_errors" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Insufficient funds errors</div>
                </div>

                <div class="metric">
                    <label>Fraud Errors (Code 59)</label>
                    <input type="number" id="fraud_errors" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Suspected fraud errors</div>
                </div>

                <div class="metric">
                    <label>AVS Mismatch (Code 5C)</label>
                    <input type="number" id="avs_errors" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Address verification errors</div>
                </div>

                <div class="metric">
                    <label>Error Rate %</label>
                    <input type="number" id="error_rate" placeholder="0" step="0.01" readonly>
                    <div class="target">Errors / total transactions</div>
                </div>
            </div>
        </div>

        <!-- Monthly Notes -->
        <div class="section">
            <h2>üìù Monthly Summary & Insights</h2>
            <div style="margin-bottom: 20px;">
                <label style="font-weight: 600; margin-bottom: 10px; display: block;">Key Wins This Month:</label>
                <textarea id="monthly_wins" placeholder="‚Ä¢ What went well this month?&#10;‚Ä¢ Major achievements?&#10;‚Ä¢ Performance breakthroughs?"></textarea>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="font-weight: 600; margin-bottom: 10px; display: block;">Challenges & Issues:</label>
                <textarea id="monthly_challenges" placeholder="‚Ä¢ What challenges did we face?&#10;‚Ä¢ Recurring issues?&#10;‚Ä¢ Escalations needed?"></textarea>
            </div>

            <div>
                <label style="font-weight: 600; margin-bottom: 10px; display: block;">Action Items for Next Month:</label>
                <textarea id="monthly_actions" placeholder="‚Ä¢ Priority tasks for next month?&#10;‚Ä¢ Process improvements?&#10;‚Ä¢ Goals and targets?"></textarea>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions">
            <button class="button success" onclick="saveData()">üíæ Save Monthly Report</button>
            <button class="button secondary" onclick="loadData()">üì• Load Saved Report</button>
            <button class="button secondary" onclick="clearAll()">üîÑ Clear All</button>
            <button class="button secondary" onclick="window.print()">üñ®Ô∏è Print Report</button>

            <div style="margin-top: 20px;">
                <span id="firebase-status" style="color: #666; font-size: 0.9em;">‚ö™ Firebase: Not Connected</span>
                <span style="margin-left: 20px; color: #666;">|</span>
                <span id="autosave-status" style="margin-left: 20px; color: #667eea; font-size: 0.9em; font-weight: 600;">üîÑ Real-time sync enabled</span>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, child } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDgmYEkv6lqN9FjUOtzEt2SvSPCKCbg66M",
            authDomain: "tracker-mybambu.firebaseapp.com",
            databaseURL: "https://tracker-mybambu-default-rtdb.firebaseio.com",
            projectId: "tracker-mybambu",
            storageBucket: "tracker-mybambu.firebasestorage.app",
            messagingSenderId: "352310570720",
            appId: "1:352310570720:web:33cdb90dce0da36c91ea85",
            measurementId: "G-MR4DWKWG9F"
        };

        let app, database;
        try {
            app = initializeApp(firebaseConfig);
            database = getDatabase(app);
            document.getElementById('firebase-status').innerHTML = 'üü¢ Firebase: Connected';
            document.getElementById('firebase-status').style.color = '#10b981';
            window.firebaseDB = database;
        } catch (error) {
            console.error('Firebase error:', error);
            document.getElementById('firebase-status').innerHTML = 'üî¥ Firebase: Error';
            document.getElementById('firebase-status').style.color = '#ef4444';
        }

        window.saveToFirebase = async function(data, weekId) {
            if (!database) return false;
            try {
                const dbRef = ref(database, 'bambu-pay-monthly/' + weekId);
                await set(dbRef, { ...data, lastUpdated: new Date().toISOString() });
                return true;
            } catch (error) {
                console.error('Save error:', error);
                return false;
            }
        };

        window.loadFromFirebase = async function(weekId) {
            if (!database) return null;
            try {
                const dbRef = ref(database);
                const snapshot = await get(child(dbRef, 'bambu-pay-monthly/' + weekId));
                return snapshot.exists() ? snapshot.val() : null;
            } catch (error) {
                console.error('Load error:', error);
                return null;
            }
        };
    </script>

    <script>
        function updateMonthDates() {
            const month = document.getElementById('monthSelect').value;
            const months = {
                '1': 'January 2025', '2': 'February 2025', '3': 'March 2025',
                '4': 'April 2025', '5': 'May 2025', '6': 'June 2025',
                '7': 'July 2025', '8': 'August 2025', '9': 'September 2025',
                '10': 'October 2025', '11': 'November 2025', '12': 'December 2025'
            };
            document.getElementById('monthDates').textContent = months[month];
            loadData();
        }

        function calculateMetrics() {
            const totalTxns = parseFloat(document.getElementById('total_txns').value) || 0;
            const successfulTxns = parseFloat(document.getElementById('successful_txns').value) || 0;
            const totalVolume = parseFloat(document.getElementById('total_volume').value) || 0;
            const platformRevenue = parseFloat(document.getElementById('platform_revenue').value) || 0;
            const totalErrors = parseFloat(document.getElementById('total_errors').value) || 0;

            // Calculate averages (30-day month)
            document.getElementById('avg_daily_txns').value = (totalTxns / 30).toFixed(1);

            const successRate = totalTxns > 0 ? (successfulTxns / totalTxns * 100) : 0;
            document.getElementById('success_rate').value = successRate.toFixed(2);

            const avgTxnSize = successfulTxns > 0 ? (totalVolume / successfulTxns) : 0;
            document.getElementById('avg_txn_size').value = avgTxnSize.toFixed(2);

            const errorRate = totalTxns > 0 ? (totalErrors / totalTxns * 100) : 0;
            document.getElementById('error_rate').value = errorRate.toFixed(2);

            // Opt-ins
            const portalOptins = parseFloat(document.getElementById('portal_optins').value) || 0;
            const bambuPayOptins = parseFloat(document.getElementById('bambupay_optins').value) || 0;
            const totalOptins = portalOptins + bambuPayOptins;

            document.getElementById('total_optins').value = totalOptins;
            document.getElementById('avg_daily_optins').value = (totalOptins / 30).toFixed(1);

            // Update summary cards
            document.getElementById('summary_txns').textContent = totalTxns.toLocaleString();
            document.getElementById('summary_success').textContent = successRate.toFixed(1) + '%';
            document.getElementById('summary_volume').textContent = '$' + totalVolume.toLocaleString();
            document.getElementById('summary_revenue').textContent = '$' + platformRevenue.toLocaleString();

            // Trigger autosave
            triggerRealtimeSave();
        }

        async function saveData() {
            const month = document.getElementById('monthSelect').value;
            const monthId = '2025-month-' + month;

            const data = {
                month: month,
                total_txns: document.getElementById('total_txns').value,
                successful_txns: document.getElementById('successful_txns').value,
                total_volume: document.getElementById('total_volume').value,
                platform_revenue: document.getElementById('platform_revenue').value,
                total_errors: document.getElementById('total_errors').value,
                portal_optins: document.getElementById('portal_optins').value,
                bambupay_optins: document.getElementById('bambupay_optins').value,
                mom_growth: document.getElementById('mom_growth').value,
                new_users: document.getElementById('new_users').value,
                debit_txns: document.getElementById('debit_txns').value,
                debit_success: document.getElementById('debit_success').value,
                credit_txns: document.getElementById('credit_txns').value,
                credit_success: document.getElementById('credit_success').value,
                prepaid_txns: document.getElementById('prepaid_txns').value,
                prepaid_success: document.getElementById('prepaid_success').value,
                nsf_errors: document.getElementById('nsf_errors').value,
                fraud_errors: document.getElementById('fraud_errors').value,
                avs_errors: document.getElementById('avs_errors').value,
                monthly_wins: document.getElementById('monthly_wins').value,
                monthly_challenges: document.getElementById('monthly_challenges').value,
                monthly_actions: document.getElementById('monthly_actions').value
            };

            localStorage.setItem(monthId, JSON.stringify(data));
            const success = await window.saveToFirebase(data, monthId);

            alert(success ? '‚úÖ Monthly report saved!' : '‚ö†Ô∏è Saved locally only');
            return success;
        }

        async function loadData() {
            const month = document.getElementById('monthSelect').value;
            const monthId = '2025-month-' + month;

            const firebaseData = await window.loadFromFirebase(monthId);
            let data = firebaseData || JSON.parse(localStorage.getItem(monthId) || 'null');

            if (!data) return;

            Object.keys(data).forEach(key => {
                const element = document.getElementById(key);
                if (element) element.value = data[key];
            });

            calculateMetrics();
        }

        function clearAll() {
            if (confirm('Clear all fields?')) {
                document.querySelectorAll('input[type="number"], textarea').forEach(el => {
                    if (!el.readOnly) el.value = '';
                });
                calculateMetrics();
            }
        }

        let autosaveTimer;
        let isSaving = false;

        async function triggerRealtimeSave() {
            if (isSaving) return;

            const statusEl = document.getElementById('autosave-status');
            statusEl.textContent = 'üíæ Saving...';
            statusEl.classList.add('saving-pulse');

            isSaving = true;
            const success = await saveData();
            isSaving = false;

            statusEl.classList.remove('saving-pulse');
            statusEl.textContent = success ? '‚úÖ Saved to Firebase' : '‚ö†Ô∏è Save Failed';
            statusEl.style.color = success ? '#10b981' : '#ef4444';

            setTimeout(() => {
                statusEl.textContent = 'üîÑ Real-time sync enabled';
                statusEl.style.color = '#667eea';
            }, 2000);
        }

        document.querySelectorAll('input, textarea').forEach(input => {
            input.addEventListener('input', () => {
                clearTimeout(autosaveTimer);
                autosaveTimer = setTimeout(() => calculateMetrics(), 500);
            });
        });

        window.addEventListener('load', loadData);
    </script>
</body>
</html>
