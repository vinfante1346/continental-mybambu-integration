<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bambu Pay 2.0 Daily Tracker - November 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: white;
            color: #667eea;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .date-selector {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .date-selector input {
            padding: 10px;
            font-size: 1.1em;
            border: 2px solid #667eea;
            border-radius: 5px;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 5px solid #667eea;
        }

        .summary-card.success {
            border-left-color: #10b981;
        }

        .summary-card.warning {
            border-left-color: #f59e0b;
        }

        .summary-card.error {
            border-left-color: #ef4444;
        }

        .summary-card .label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .summary-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .summary-card.success .value {
            color: #10b981;
        }

        .summary-card.warning .value {
            color: #f59e0b;
        }

        .summary-card.error .value {
            color: #ef4444;
        }

        .section {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #667eea;
            font-size: 1.8em;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
            transition: all 0.3s;
        }

        .metric:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .metric label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .metric input {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            border: 2px solid #ddd;
            border-radius: 5px;
            transition: border-color 0.3s;
        }

        .metric input:focus {
            outline: none;
            border-color: #667eea;
        }

        .metric input:read-only {
            background: #e9ecef;
            cursor: not-allowed;
        }

        .metric .target {
            font-size: 0.85em;
            color: #666;
            margin-top: 5px;
            font-style: italic;
        }

        .metric .variance {
            font-weight: bold;
            margin-top: 8px;
            padding: 8px;
            border-radius: 5px;
            text-align: center;
        }

        .variance.positive {
            color: #10b981;
            background-color: #d1fae5;
        }

        .variance.negative {
            color: #ef4444;
            background-color: #fee2e2;
        }

        .button {
            background: #667eea;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .button:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .button.secondary {
            background: #6b7280;
        }

        .button.secondary:hover {
            background: #4b5563;
        }

        .button.success {
            background: #10b981;
        }

        .button.success:hover {
            background: #059669;
        }

        .actions {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .insights-box {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 25px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 5px solid #f59e0b;
        }

        .insights-box h3 {
            color: #92400e;
            margin-bottom: 15px;
        }

        .insights-box ul {
            margin-left: 20px;
            line-height: 1.8;
            color: #78350f;
        }

        .chart-container {
            margin-top: 20px;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e5e7eb;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: width 0.5s ease;
        }

        .progress-fill.success {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }

        .progress-fill.warning {
            background: linear-gradient(90deg, #f59e0b 0%, #d97706 100%);
        }

        .progress-fill.danger {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            font-size: 1em;
            min-height: 120px;
            transition: border-color 0.3s;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .summary-cards {
                grid-template-columns: 1fr;
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }

        .saving-pulse {
            animation: pulse 1s ease-in-out infinite;
        }

        @media print {
            body {
                background: white;
            }
            .actions {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí≥ Bambu Pay 2.0 Daily Tracker</h1>
            <p style="font-size: 1.2em; color: #666; margin-top: 10px;">TabaPay Payment Processing Analytics</p>
        </div>

        <div class="date-selector">
            <div>
                <label for="trackingDate"><strong>Tracking Date:</strong></label>
                <input type="date" id="trackingDate" value="">
            </div>
            <div style="color: #666;">
                Day <strong id="dayNumber">1</strong> of 30 | <span id="dayOfWeek">Monday</span>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards">
            <div class="summary-card">
                <div class="label">Total Transactions</div>
                <div class="value" id="summary_txns">0</div>
            </div>
            <div class="summary-card success">
                <div class="label">Success Rate</div>
                <div class="value" id="summary_success">0%</div>
            </div>
            <div class="summary-card">
                <div class="label">Transaction Volume</div>
                <div class="value" id="summary_volume">$0</div>
            </div>
            <div class="summary-card warning">
                <div class="label">Platform Revenue</div>
                <div class="value" id="summary_revenue">$0</div>
            </div>
            <div class="summary-card error">
                <div class="label">Error Count</div>
                <div class="value" id="summary_errors">0</div>
            </div>
            <div class="summary-card">
                <div class="label">Avg Transaction</div>
                <div class="value" id="summary_avg">$0</div>
            </div>
        </div>

        <!-- Core Performance Metrics -->
        <div class="section">
            <h2>üìä Core Performance Metrics</h2>

            <div class="metrics-grid">
                <div class="metric">
                    <label>Total Daily Transactions</label>
                    <input type="number" id="total_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Target: 1,915 | Nov 12 Baseline: 1,782</div>
                    <div id="total_txns_var" class="variance"></div>
                </div>

                <div class="metric">
                    <label>Successful Transactions</label>
                    <input type="number" id="successful_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12 Baseline: 1,466 (82.27%)</div>
                </div>

                <div class="metric">
                    <label>Failed Transactions</label>
                    <input type="number" id="failed_txns" placeholder="0" readonly>
                    <div class="target">Nov 12 Baseline: 309 (17.73%)</div>
                </div>

                <div class="metric">
                    <label>Success Rate %</label>
                    <input type="number" id="success_rate" placeholder="0" step="0.01" readonly>
                    <div class="target">Target: 90%+ | Nov 12: 82.27%</div>
                    <div id="success_rate_var" class="variance"></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="success_progress" style="width: 0%;">0%</div>
                    </div>
                </div>

                <div class="metric">
                    <label>Total Transaction Volume</label>
                    <input type="number" id="total_volume" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Target: $500,000 | Nov 12: $168,415</div>
                    <div id="total_volume_var" class="variance"></div>
                </div>

                <div class="metric">
                    <label>Average Transaction Size</label>
                    <input type="number" id="avg_txn" placeholder="0" step="0.01" readonly>
                    <div class="target">Nov 12 Baseline: $114.88</div>
                </div>

                <div class="metric">
                    <label>Platform Revenue (Fees)</label>
                    <input type="number" id="platform_revenue" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Nov 12: $146.60 (0.087% effective fee rate)</div>
                </div>

                <div class="metric">
                    <label>Effective Fee Rate %</label>
                    <input type="number" id="fee_rate" placeholder="0" step="0.001" readonly>
                    <div class="target">Nov 12 Baseline: 0.087%</div>
                </div>
            </div>
        </div>

        <!-- Transaction Mix -->
        <div class="section">
            <h2>üîÑ Transaction Mix</h2>

            <div class="metrics-grid">
                <div class="metric">
                    <label>Purchase Transactions</label>
                    <input type="number" id="purchases" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 1,021 (57.3%)</div>
                </div>

                <div class="metric">
                    <label>Purchase Success Rate %</label>
                    <input type="number" id="purchase_success_rate" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Track purchase-specific success</div>
                </div>

                <div class="metric">
                    <label>Disbursement Transactions</label>
                    <input type="number" id="disbursements" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 761 (42.7%)</div>
                </div>

                <div class="metric">
                    <label>Disbursement Success Rate %</label>
                    <input type="number" id="disbursement_success_rate" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Track disbursement-specific success</div>
                </div>

                <div class="metric">
                    <label>Purchase/Disbursement Ratio</label>
                    <input type="text" id="mix_ratio" placeholder="0:0" readonly>
                    <div class="target">Nov 12 Baseline: 57.3% / 42.7%</div>
                </div>

                <div class="metric">
                    <label>Net Position</label>
                    <input type="number" id="net_position" placeholder="0" readonly>
                    <div class="target">Nov 12: +260 (purchase-heavy)</div>
                </div>
            </div>
        </div>

        <!-- Network Distribution -->
        <div class="section">
            <h2>üåê Network Distribution</h2>

            <div class="metrics-grid">
                <div class="metric">
                    <label>Visa Transactions</label>
                    <input type="number" id="visa_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 1,458 (81.8%)</div>
                </div>

                <div class="metric">
                    <label>Visa Success Rate %</label>
                    <input type="number" id="visa_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Track Visa-specific performance</div>
                </div>

                <div class="metric">
                    <label>Mastercard Transactions</label>
                    <input type="number" id="mastercard_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 316 (17.7%)</div>
                </div>

                <div class="metric">
                    <label>Mastercard Success Rate %</label>
                    <input type="number" id="mastercard_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Track Mastercard-specific performance</div>
                </div>

                <div class="metric">
                    <label>Discover Transactions</label>
                    <input type="number" id="discover_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 8 (0.4%)</div>
                </div>

                <div class="metric">
                    <label>Discover Success Rate %</label>
                    <input type="number" id="discover_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Track Discover-specific performance</div>
                </div>
            </div>
        </div>

        <!-- Card Type Performance -->
        <div class="section">
            <h2>üí≥ Card Type Performance</h2>

            <div class="metrics-grid">
                <div class="metric">
                    <label>Debit Card Transactions</label>
                    <input type="number" id="debit_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 1,587 (89.1% of volume)</div>
                </div>

                <div class="metric">
                    <label>Debit Card Success Rate %</label>
                    <input type="number" id="debit_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Target: 85%+ | Nov 12: 85.7%</div>
                    <div id="debit_success_var" class="variance"></div>
                    <div class="progress-bar">
                        <div class="progress-fill success" id="debit_progress" style="width: 0%;">0%</div>
                    </div>
                </div>

                <div class="metric">
                    <label>Credit Card Transactions</label>
                    <input type="number" id="credit_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 104 (5.8% of volume)</div>
                </div>

                <div class="metric">
                    <label>Credit Card Success Rate %</label>
                    <input type="number" id="credit_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Target: 70%+ | Nov 12: 46.15%</div>
                    <div id="credit_success_var" class="variance"></div>
                    <div class="progress-bar">
                        <div class="progress-fill danger" id="credit_progress" style="width: 0%;">0%</div>
                    </div>
                </div>

                <div class="metric">
                    <label>Prepaid Card Transactions</label>
                    <input type="number" id="prepaid_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 91 (5.1% of volume)</div>
                </div>

                <div class="metric">
                    <label>Prepaid Card Success Rate %</label>
                    <input type="number" id="prepaid_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Target: 80%+ | Nov 12: 63.74%</div>
                    <div id="prepaid_success_var" class="variance"></div>
                    <div class="progress-bar">
                        <div class="progress-fill warning" id="prepaid_progress" style="width: 0%;">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Analysis -->
        <div class="section">
            <h2>‚ö†Ô∏è Error Analysis</h2>

            <div class="metrics-grid">
                <div class="metric">
                    <label>Total Errors</label>
                    <input type="number" id="total_errors" placeholder="0" readonly>
                    <div class="target">Target: <200 | Nov 12: 309 (17.3%)</div>
                    <div id="total_errors_var" class="variance"></div>
                </div>

                <div class="metric">
                    <label>Error Rate %</label>
                    <input type="number" id="error_rate" placeholder="0" step="0.01" readonly>
                    <div class="target">Target: <10% | Nov 12: 17.3%</div>
                </div>

                <div class="metric">
                    <label>Insufficient Funds (Code 51)</label>
                    <input type="number" id="nsf_errors" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 153 (49.5% of errors)</div>
                </div>

                <div class="metric">
                    <label>NSF % of Total Errors</label>
                    <input type="number" id="nsf_percent" placeholder="0" step="0.01" readonly>
                    <div class="target">Nov 12 Baseline: 49.5%</div>
                </div>

                <div class="metric">
                    <label>Suspected Fraud (Code 59)</label>
                    <input type="number" id="fraud_errors" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 43 (13.9% of errors)</div>
                </div>

                <div class="metric">
                    <label>Fraud % of Total Errors</label>
                    <input type="number" id="fraud_percent" placeholder="0" step="0.01" readonly>
                    <div class="target">Nov 12 Baseline: 13.9%</div>
                </div>

                <div class="metric">
                    <label>Do Not Honor (Code 05)</label>
                    <input type="number" id="do_not_honor" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 27 (8.7% of errors)</div>
                </div>

                <div class="metric">
                    <label>AVS Mismatch (Code 5C)</label>
                    <input type="number" id="avs_mismatch" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 22 (7.1% of errors)</div>
                </div>

                <div class="metric">
                    <label>Security Violation (Code 63)</label>
                    <input type="number" id="security_violation" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 13 (4.2% of errors)</div>
                </div>

                <div class="metric">
                    <label>Other Errors</label>
                    <input type="number" id="other_errors" placeholder="0" readonly>
                    <div class="target">Calculated automatically</div>
                </div>
            </div>

            <div class="insights-box">
                <h3>üí° Error Reduction Strategies</h3>
                <ul>
                    <li><strong>NSF Errors:</strong> Deploy real-time balance verification before processing</li>
                    <li><strong>Fraud Flags:</strong> Optimize fraud detection rules to reduce false positives</li>
                    <li><strong>AVS Mismatch:</strong> Improve address verification UI and data quality</li>
                    <li><strong>Target:</strong> Reduce total errors to <200/day (currently 309 on Nov 12)</li>
                </ul>
            </div>
        </div>

        <!-- Geographic Performance -->
        <div class="section">
            <h2>üó∫Ô∏è Geographic Performance - Top 10 States</h2>

            <div class="metrics-grid">
                <div class="metric">
                    <label>1. Florida (FL)</label>
                    <input type="number" id="fl_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 295 (17.5%) - 78.98% success</div>
                </div>

                <div class="metric">
                    <label>2. Texas (TX)</label>
                    <input type="number" id="tx_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 252 (14.9%) - 81.75% success</div>
                </div>

                <div class="metric">
                    <label>3. New York (NY)</label>
                    <input type="number" id="ny_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 163 (9.7%) - 77.30% success</div>
                </div>

                <div class="metric">
                    <label>4. California (CA)</label>
                    <input type="number" id="ca_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 158 (9.4%) - 87.97% success</div>
                </div>

                <div class="metric">
                    <label>5. North Carolina (NC)</label>
                    <input type="number" id="nc_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 79 (4.7%) - 89.87% success</div>
                </div>

                <div class="metric">
                    <label>6. New Jersey (NJ)</label>
                    <input type="number" id="nj_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 72 (4.3%) - 83.33% success</div>
                </div>

                <div class="metric">
                    <label>7. Georgia (GA)</label>
                    <input type="number" id="ga_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 72 (4.3%) - 98.61% success ‚≠ê</div>
                </div>

                <div class="metric">
                    <label>8. Illinois (IL)</label>
                    <input type="number" id="il_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 67 (4.0%) - 73.13% success ‚ö†Ô∏è</div>
                </div>

                <div class="metric">
                    <label>9. Ohio (OH)</label>
                    <input type="number" id="oh_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 54 (3.2%) - 83.33% success</div>
                </div>

                <div class="metric">
                    <label>10. Tennessee (TN)</label>
                    <input type="number" id="tn_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 41 (2.4%) - 97.56% success ‚≠ê</div>
                </div>

                <div class="metric">
                    <label>Top 10 States Total</label>
                    <input type="number" id="top10_states" placeholder="0" readonly>
                    <div class="target">Nov 12: 1,253 (74.2% of geo-tagged txns)</div>
                </div>

                <div class="metric">
                    <label>Top 10 States %</label>
                    <input type="number" id="top10_percent" placeholder="0" step="0.1" readonly>
                    <div class="target">Nov 12: 74.2% of all geo-tagged</div>
                </div>
            </div>

            <div class="insights-box">
                <h3>üìç Geographic Insights</h3>
                <ul>
                    <li><strong>Best Performers:</strong> Georgia (98.61%) & Tennessee (97.56%) - study for best practices</li>
                    <li><strong>Sunbelt Dominance:</strong> FL + TX = 547 txns (30.7% of total volume)</li>
                    <li><strong>Improvement Needed:</strong> Illinois at 73.13% - investigate routing/issuer issues</li>
                    <li><strong>Coverage:</strong> Top 10 states represent 74.2% of all geo-tagged transactions</li>
                </ul>
            </div>
        </div>

        <!-- Transaction Size Distribution -->
        <div class="section">
            <h2>üí∞ Transaction Size Distribution</h2>

            <div class="metrics-grid">
                <div class="metric">
                    <label>Under $10</label>
                    <input type="number" id="size_under_10" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 383 (26.1%)</div>
                </div>

                <div class="metric">
                    <label>$10 - $50 (Sweet Spot)</label>
                    <input type="number" id="size_10_50" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 506 (34.5%) ‚≠ê</div>
                </div>

                <div class="metric">
                    <label>$50 - $100</label>
                    <input type="number" id="size_50_100" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 173 (11.8%)</div>
                </div>

                <div class="metric">
                    <label>$100 - $500</label>
                    <input type="number" id="size_100_500" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 277 (18.9%)</div>
                </div>

                <div class="metric">
                    <label>$500+</label>
                    <input type="number" id="size_500_plus" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 127 (8.7%)</div>
                </div>
            </div>
        </div>

        <!-- Traffic Patterns -->
        <div class="section">
            <h2>‚è∞ Traffic Patterns & Sources</h2>

            <h3 style="color: #667eea; margin: 20px 0 15px 0; font-size: 1.3em;">üìÖ Day Part Analysis</h3>
            <div class="metrics-grid">
                <div class="metric">
                    <label>Early Morning (12 AM - 6 AM)</label>
                    <input type="number" id="early_morning" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Overnight transactions</div>
                </div>

                <div class="metric">
                    <label>Morning (6 AM - 12 PM)</label>
                    <input type="number" id="morning" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Morning rush period</div>
                </div>

                <div class="metric">
                    <label>Afternoon (12 PM - 5 PM)</label>
                    <input type="number" id="afternoon" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Business hours</div>
                </div>

                <div class="metric">
                    <label>Evening (5 PM - 9 PM)</label>
                    <input type="number" id="evening" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">After work period</div>
                </div>

                <div class="metric">
                    <label>Night (9 PM - 12 AM)</label>
                    <input type="number" id="night" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: Highest activity (11 PM peak)</div>
                </div>

                <div class="metric">
                    <label>Peak Hour</label>
                    <input type="text" id="peak_hour" placeholder="e.g., 11 PM" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 11 PM</div>
                </div>

                <div class="metric">
                    <label>Peak Hour Volume</label>
                    <input type="number" id="peak_volume" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Nov 12: 444 (24.9% of daily volume)</div>
                </div>

                <div class="metric">
                    <label>Peak Hour % of Total</label>
                    <input type="number" id="peak_percent" placeholder="0" step="0.1" readonly>
                    <div class="target">Nov 12: 24.9%</div>
                </div>
            </div>

            <h3 style="color: #667eea; margin: 30px 0 15px 0; font-size: 1.3em;">üì± Channel & Source</h3>
            <div class="metrics-grid">
                <div class="metric">
                    <label>Mobile App Transactions</label>
                    <input type="number" id="mobile_app" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Track mobile app volume</div>
                </div>

                <div class="metric">
                    <label>Mobile App %</label>
                    <input type="number" id="mobile_app_percent" placeholder="0" step="0.1" readonly>
                    <div class="target">% of total transactions</div>
                </div>

                <div class="metric">
                    <label>Web Portal Transactions</label>
                    <input type="number" id="web_portal" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Track web portal volume</div>
                </div>

                <div class="metric">
                    <label>Web Portal %</label>
                    <input type="number" id="web_portal_percent" placeholder="0" step="0.1" readonly>
                    <div class="target">% of total transactions</div>
                </div>

                <div class="metric">
                    <label>API/Direct Integration</label>
                    <input type="number" id="api_direct" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Track API volume</div>
                </div>

                <div class="metric">
                    <label>API %</label>
                    <input type="number" id="api_percent" placeholder="0" step="0.1" readonly>
                    <div class="target">% of total transactions</div>
                </div>
            </div>

            <h3 style="color: #667eea; margin: 30px 0 15px 0; font-size: 1.3em;">üì≤ Device Type</h3>
            <div class="metrics-grid">
                <div class="metric">
                    <label>iOS Transactions</label>
                    <input type="number" id="ios_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">iPhone/iPad transactions</div>
                </div>

                <div class="metric">
                    <label>iOS Success Rate %</label>
                    <input type="number" id="ios_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Track iOS performance</div>
                </div>

                <div class="metric">
                    <label>Android Transactions</label>
                    <input type="number" id="android_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Android device transactions</div>
                </div>

                <div class="metric">
                    <label>Android Success Rate %</label>
                    <input type="number" id="android_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Track Android performance</div>
                </div>

                <div class="metric">
                    <label>Desktop/Web Transactions</label>
                    <input type="number" id="desktop_txns" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Desktop/browser transactions</div>
                </div>

                <div class="metric">
                    <label>Desktop Success Rate %</label>
                    <input type="number" id="desktop_success" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Track desktop performance</div>
                </div>
            </div>

            <div class="insights-box">
                <h3>üîç Traffic Insights</h3>
                <ul>
                    <li><strong>Nov 12 Peak:</strong> 11 PM with 444 transactions (24.9% of daily volume) - optimize for night traffic</li>
                    <li><strong>Pattern:</strong> Heavy evening/night usage (7 PM - midnight) - minimal business hours activity</li>
                    <li><strong>Channel Mix:</strong> Track which channels drive the most successful transactions</li>
                    <li><strong>Device Performance:</strong> Monitor success rates by device type to identify platform issues</li>
                </ul>
            </div>
        </div>

        <!-- Growth Metrics -->
        <div class="section">
            <h2>üìà Growth & Engagement</h2>

            <div class="metrics-grid">
                <div class="metric">
                    <label>Daily Opt-Ins</label>
                    <input type="number" id="daily_optins" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Target: 1,667/day (50k monthly)</div>
                    <div id="daily_optins_var" class="variance"></div>
                </div>

                <div class="metric">
                    <label>Cumulative MTD Opt-Ins</label>
                    <input type="number" id="mtd_optins" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Target: 50,000/month</div>
                    <div id="mtd_optins_var" class="variance"></div>
                </div>

                <div class="metric">
                    <label>New Active Users (DAU)</label>
                    <input type="number" id="new_users" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Track daily activation</div>
                </div>

                <div class="metric">
                    <label>Unique Transacting Users</label>
                    <input type="number" id="unique_users" placeholder="0" oninput="calculateMetrics()">
                    <div class="target">Track unique customer count</div>
                </div>

                <div class="metric">
                    <label>Transactions per User</label>
                    <input type="number" id="txns_per_user" placeholder="0" step="0.1" readonly>
                    <div class="target">Track engagement depth</div>
                </div>

                <div class="metric">
                    <label>Repeat Transaction Rate %</label>
                    <input type="number" id="repeat_rate" placeholder="0" step="0.01" oninput="calculateMetrics()">
                    <div class="target">Track customer retention</div>
                </div>
            </div>
        </div>

        <!-- Daily Notes -->
        <div class="section">
            <h2>üìù Daily Performance Summary</h2>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px; margin-bottom: 20px;">
                <!-- Key Wins -->
                <div style="background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); padding: 20px; border-radius: 8px; border-left: 5px solid #10b981;">
                    <h3 style="color: #065f46; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5em;">‚úÖ</span> Key Wins
                    </h3>
                    <textarea id="key_wins" placeholder="‚Ä¢ What went well today?&#10;‚Ä¢ Any performance breakthroughs?&#10;‚Ä¢ Success stories to celebrate?" style="background: white; min-height: 120px;"></textarea>
                </div>

                <!-- Blockers & Issues -->
                <div style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); padding: 20px; border-radius: 8px; border-left: 5px solid #ef4444;">
                    <h3 style="color: #991b1b; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 1.5em;">‚ö†Ô∏è</span> Blockers & Issues
                    </h3>
                    <textarea id="blockers" placeholder="‚Ä¢ What's holding us back?&#10;‚Ä¢ Unexpected challenges?&#10;‚Ä¢ Issues needing escalation?" style="background: white; min-height: 120px;"></textarea>
                </div>
            </div>

            <!-- Key Observations -->
            <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 20px; border-radius: 8px; border-left: 5px solid #3b82f6; margin-bottom: 20px;">
                <h3 style="color: #1e40af; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5em;">üìä</span> Key Observations & Insights
                </h3>
                <textarea id="observations" placeholder="‚Ä¢ Interesting patterns or trends noticed today?&#10;‚Ä¢ Data anomalies or unexpected results?&#10;‚Ä¢ Customer behavior insights?&#10;‚Ä¢ Performance vs baseline analysis?" style="background: white; min-height: 100px;"></textarea>
            </div>

            <!-- Action Items -->
            <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 25px; border-radius: 8px; border-left: 5px solid #f59e0b;">
                <h3 style="color: #92400e; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5em;">üéØ</span> Action Items & Next Steps
                </h3>

                <div id="action-items-container">
                    <!-- Action items will be added here -->
                </div>

                <button class="button" onclick="addActionItem()" style="background: #f59e0b; margin-top: 15px;">
                    ‚ûï Add Action Item
                </button>
            </div>

            <!-- General Notes -->
            <div style="background: #f9fafb; padding: 20px; border-radius: 8px; border: 2px dashed #d1d5db; margin-top: 20px;">
                <h3 style="color: #4b5563; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5em;">üìù</span> Additional Notes
                </h3>
                <textarea id="additional_notes" placeholder="Any other notes, context, or information for this day..." style="background: white; min-height: 80px;"></textarea>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions">
            <button class="button success" onclick="loadNov12Baseline()">üìä Load Nov 12 Baseline</button>
            <button class="button" onclick="saveData()">üíæ Save to Firebase</button>
            <button class="button secondary" onclick="loadData()">üì• Load from Firebase</button>
            <button class="button secondary" onclick="exportToCSV()">üì§ Export CSV</button>
            <button class="button secondary" onclick="clearAll()">üîÑ Clear All</button>
            <button class="button secondary" onclick="window.print()">üñ®Ô∏è Print Report</button>

            <div style="margin-top: 20px;">
                <span id="firebase-status" style="color: #666; font-size: 0.9em;">‚ö™ Firebase: Not Connected</span>
                <span style="margin-left: 20px; color: #666;">|</span>
                <span id="autosave-status" style="margin-left: 20px; color: #667eea; font-size: 0.9em; font-weight: 600;">üîÑ Real-time sync enabled</span>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, child } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDgmYEkv6lqN9FjUOtzEt2SvSPCKCbg66M",
            authDomain: "tracker-mybambu.firebaseapp.com",
            databaseURL: "https://tracker-mybambu-default-rtdb.firebaseio.com",
            projectId: "tracker-mybambu",
            storageBucket: "tracker-mybambu.firebasestorage.app",
            messagingSenderId: "352310570720",
            appId: "1:352310570720:web:33cdb90dce0da36c91ea85",
            measurementId: "G-MR4DWKWG9F"
        };

        let app, database;
        try {
            app = initializeApp(firebaseConfig);
            database = getDatabase(app);
            document.getElementById('firebase-status').innerHTML = 'üü¢ Firebase: Connected';
            document.getElementById('firebase-status').style.color = '#10b981';
            window.firebaseDB = database;
        } catch (error) {
            console.error('Firebase error:', error);
            document.getElementById('firebase-status').innerHTML = 'üî¥ Firebase: Error';
            document.getElementById('firebase-status').style.color = '#ef4444';
        }

        window.saveToFirebase = async function(data, date) {
            if (!database) return false;
            try {
                const dbRef = ref(database, 'bambu-pay-tracker/' + date);
                await set(dbRef, { ...data, lastUpdated: new Date().toISOString() });
                return true;
            } catch (error) {
                console.error('Save error:', error);
                return false;
            }
        };

        window.loadFromFirebase = async function(date) {
            if (!database) return null;
            try {
                const dbRef = ref(database);
                const snapshot = await get(child(dbRef, 'bambu-pay-tracker/' + date));
                return snapshot.exists() ? snapshot.val() : null;
            } catch (error) {
                console.error('Load error:', error);
                return null;
            }
        };
    </script>

    <script>
        // Initialize date
        document.getElementById('trackingDate').valueAsDate = new Date();
        updateDayInfo();

        function updateDayInfo() {
            const date = new Date(document.getElementById('trackingDate').value);
            document.getElementById('dayNumber').textContent = date.getDate();

            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            document.getElementById('dayOfWeek').textContent = days[date.getDay()];
        }

        document.getElementById('trackingDate').addEventListener('change', function() {
            updateDayInfo();
            onDateChange();
        });

        function calculateMetrics() {
            // Core metrics
            const totalTxns = parseFloat(document.getElementById('total_txns').value) || 0;
            const successfulTxns = parseFloat(document.getElementById('successful_txns').value) || 0;
            const totalVolume = parseFloat(document.getElementById('total_volume').value) || 0;
            const platformRevenue = parseFloat(document.getElementById('platform_revenue').value) || 0;

            // Calculate derived metrics
            const failedTxns = totalTxns - successfulTxns;
            document.getElementById('failed_txns').value = failedTxns;

            const successRate = totalTxns > 0 ? (successfulTxns / totalTxns * 100) : 0;
            document.getElementById('success_rate').value = successRate.toFixed(2);

            const avgTxn = successfulTxns > 0 ? (totalVolume / successfulTxns) : 0;
            document.getElementById('avg_txn').value = avgTxn.toFixed(2);

            const feeRate = totalVolume > 0 ? (platformRevenue / totalVolume * 100) : 0;
            document.getElementById('fee_rate').value = feeRate.toFixed(3);

            // Transaction mix
            const purchases = parseFloat(document.getElementById('purchases').value) || 0;
            const disbursements = parseFloat(document.getElementById('disbursements').value) || 0;
            const netPosition = purchases - disbursements;
            document.getElementById('net_position').value = netPosition;

            if (totalTxns > 0) {
                const purchasePct = (purchases / totalTxns * 100).toFixed(1);
                const disbursePct = (disbursements / totalTxns * 100).toFixed(1);
                document.getElementById('mix_ratio').value = `${purchasePct}% / ${disbursePct}%`;
            }

            // Error calculations
            const nsfErrors = parseFloat(document.getElementById('nsf_errors').value) || 0;
            const fraudErrors = parseFloat(document.getElementById('fraud_errors').value) || 0;
            const doNotHonor = parseFloat(document.getElementById('do_not_honor').value) || 0;
            const avsMismatch = parseFloat(document.getElementById('avs_mismatch').value) || 0;
            const securityViolation = parseFloat(document.getElementById('security_violation').value) || 0;

            const knownErrors = nsfErrors + fraudErrors + doNotHonor + avsMismatch + securityViolation;
            const totalErrors = failedTxns;
            const otherErrors = Math.max(0, totalErrors - knownErrors);

            document.getElementById('total_errors').value = totalErrors;
            document.getElementById('other_errors').value = otherErrors;

            const errorRate = totalTxns > 0 ? (totalErrors / totalTxns * 100) : 0;
            document.getElementById('error_rate').value = errorRate.toFixed(2);

            if (totalErrors > 0) {
                document.getElementById('nsf_percent').value = (nsfErrors / totalErrors * 100).toFixed(2);
                document.getElementById('fraud_percent').value = (fraudErrors / totalErrors * 100).toFixed(2);
            }

            // Geographic totals
            const fl = parseFloat(document.getElementById('fl_txns').value) || 0;
            const tx = parseFloat(document.getElementById('tx_txns').value) || 0;
            const ny = parseFloat(document.getElementById('ny_txns').value) || 0;
            const ca = parseFloat(document.getElementById('ca_txns').value) || 0;
            const nc = parseFloat(document.getElementById('nc_txns').value) || 0;
            const nj = parseFloat(document.getElementById('nj_txns').value) || 0;
            const ga = parseFloat(document.getElementById('ga_txns').value) || 0;
            const il = parseFloat(document.getElementById('il_txns').value) || 0;
            const oh = parseFloat(document.getElementById('oh_txns').value) || 0;
            const tn = parseFloat(document.getElementById('tn_txns').value) || 0;

            const top10Total = fl + tx + ny + ca + nc + nj + ga + il + oh + tn;
            document.getElementById('top10_states').value = top10Total;

            if (totalTxns > 0) {
                document.getElementById('top10_percent').value = (top10Total / totalTxns * 100).toFixed(1);
            }

            // Traffic pattern percentages
            const peakVolume = parseFloat(document.getElementById('peak_volume').value) || 0;
            if (totalTxns > 0 && peakVolume > 0) {
                document.getElementById('peak_percent').value = (peakVolume / totalTxns * 100).toFixed(1);
            }

            // Channel percentages
            const mobileApp = parseFloat(document.getElementById('mobile_app').value) || 0;
            const webPortal = parseFloat(document.getElementById('web_portal').value) || 0;
            const apiDirect = parseFloat(document.getElementById('api_direct').value) || 0;

            if (totalTxns > 0) {
                document.getElementById('mobile_app_percent').value = (mobileApp / totalTxns * 100).toFixed(1);
                document.getElementById('web_portal_percent').value = (webPortal / totalTxns * 100).toFixed(1);
                document.getElementById('api_percent').value = (apiDirect / totalTxns * 100).toFixed(1);
            }

            // User metrics
            const uniqueUsers = parseFloat(document.getElementById('unique_users').value) || 0;
            const txnsPerUser = uniqueUsers > 0 ? (totalTxns / uniqueUsers) : 0;
            document.getElementById('txns_per_user').value = txnsPerUser.toFixed(1);

            // Update summary cards
            document.getElementById('summary_txns').textContent = totalTxns.toLocaleString();
            document.getElementById('summary_success').textContent = successRate.toFixed(1) + '%';
            document.getElementById('summary_volume').textContent = '$' + totalVolume.toLocaleString();
            document.getElementById('summary_revenue').textContent = '$' + platformRevenue.toLocaleString();
            document.getElementById('summary_errors').textContent = totalErrors.toLocaleString();
            document.getElementById('summary_avg').textContent = '$' + avgTxn.toFixed(2);

            // Update progress bars
            updateProgressBar('success_progress', successRate, 90);

            const debitSuccess = parseFloat(document.getElementById('debit_success').value) || 0;
            updateProgressBar('debit_progress', debitSuccess, 85);

            const creditSuccess = parseFloat(document.getElementById('credit_success').value) || 0;
            updateProgressBar('credit_progress', creditSuccess, 70);

            const prepaidSuccess = parseFloat(document.getElementById('prepaid_success').value) || 0;
            updateProgressBar('prepaid_progress', prepaidSuccess, 80);

            // Calculate variances
            calculateVariance('total_txns', 1915);
            calculateVariance('success_rate', 90, '%');
            calculateVariance('total_volume', 500000);
            calculateVariance('debit_success', 85, '%');
            calculateVariance('credit_success', 70, '%');
            calculateVariance('prepaid_success', 80, '%');
            calculateVariance('total_errors', 200);
            calculateVariance('daily_optins', 1667);
            calculateVariance('mtd_optins', 50000);
        }

        function updateProgressBar(id, value, target) {
            const element = document.getElementById(id);
            const percentage = Math.min(100, (value / target) * 100);
            element.style.width = percentage + '%';
            element.textContent = value.toFixed(1) + '%';

            // Update color based on performance
            element.className = 'progress-fill';
            if (percentage >= 100) element.classList.add('success');
            else if (percentage >= 80) element.classList.add('warning');
            else element.classList.add('danger');
        }

        function calculateVariance(inputId, target, suffix = '') {
            const actual = parseFloat(document.getElementById(inputId).value) || 0;
            const variance = actual - target;
            const percentVariance = target > 0 ? ((variance / target) * 100).toFixed(1) : 0;

            const varElement = document.getElementById(inputId + '_var');
            if (!varElement || actual === 0) return;

            const sign = variance >= 0 ? '+' : '';
            const formattedValue = Math.abs(variance).toLocaleString();

            varElement.textContent = `${sign}${formattedValue} (${sign}${percentVariance}%)`;
            varElement.className = variance >= 0 ? 'variance positive' : 'variance negative';
        }

        function loadNov12Baseline() {
            document.getElementById('trackingDate').value = '2025-11-12';
            updateDayInfo();

            // Core metrics
            document.getElementById('total_txns').value = '1782';
            document.getElementById('successful_txns').value = '1466';
            document.getElementById('total_volume').value = '168415';
            document.getElementById('platform_revenue').value = '146.60';

            // Transaction mix
            document.getElementById('purchases').value = '1021';
            document.getElementById('disbursements').value = '761';

            // Network
            document.getElementById('visa_txns').value = '1458';
            document.getElementById('mastercard_txns').value = '316';
            document.getElementById('discover_txns').value = '8';

            // Card types
            document.getElementById('debit_txns').value = '1587';
            document.getElementById('debit_success').value = '85.7';
            document.getElementById('credit_txns').value = '104';
            document.getElementById('credit_success').value = '46.15';
            document.getElementById('prepaid_txns').value = '91';
            document.getElementById('prepaid_success').value = '63.74';

            // Errors
            document.getElementById('nsf_errors').value = '153';
            document.getElementById('fraud_errors').value = '43';
            document.getElementById('do_not_honor').value = '27';
            document.getElementById('avs_mismatch').value = '22';
            document.getElementById('security_violation').value = '13';

            // Geographic - Top 10 states
            document.getElementById('fl_txns').value = '295';
            document.getElementById('tx_txns').value = '252';
            document.getElementById('ny_txns').value = '163';
            document.getElementById('ca_txns').value = '158';
            document.getElementById('nc_txns').value = '79';
            document.getElementById('nj_txns').value = '72';
            document.getElementById('ga_txns').value = '72';
            document.getElementById('il_txns').value = '67';
            document.getElementById('oh_txns').value = '54';
            document.getElementById('tn_txns').value = '41';

            // Traffic
            document.getElementById('peak_hour').value = '11 PM';
            document.getElementById('peak_volume').value = '444';

            // Transaction sizes
            document.getElementById('size_under_10').value = '383';
            document.getElementById('size_10_50').value = '506';
            document.getElementById('size_50_100').value = '173';
            document.getElementById('size_100_500').value = '277';
            document.getElementById('size_500_plus').value = '127';

            // Populate structured notes
            document.getElementById('key_wins').value = '‚úÖ Processed 1,782 transactions totaling $168,415\n' +
                '‚úÖ Strong debit card performance: 85.7% success rate (1,587 cards)\n' +
                '‚úÖ Georgia state excellence: 98.61% success rate (72 transactions)\n' +
                '‚úÖ California performance: 87.97% success rate (158 transactions)\n' +
                '‚úÖ Visa network dominance: 81.8% market share (1,458 transactions)\n' +
                '‚úÖ Peak efficiency: 11 PM with 444 transactions (24.9% of daily volume)\n' +
                '‚úÖ Transaction volume sweet spot: $10-$50 range (506 txns - 34.5%)';

            document.getElementById('blockers').value = '‚ö†Ô∏è Overall success rate at 82.27% vs 90% target (-7.73pp gap)\n' +
                '‚ö†Ô∏è Credit card success critically low: 46.15% vs 70% target (-23.85pp)\n' +
                '‚ö†Ô∏è Prepaid card success below target: 63.74% vs 80% target (-16.26pp)\n' +
                '‚ö†Ô∏è High NSF error rate: 153 errors (49.5% of all failures)\n' +
                '‚ö†Ô∏è Fraud detection false positives: 43 legitimate transactions flagged\n' +
                '‚ö†Ô∏è Geographic performance gaps: IL (73.13%), NY (77.30%), FL (78.98%)';

            document.getElementById('observations').value = 'üìä TRANSACTION MIX: Purchase-heavy day with 1,021 purchases vs 761 disbursements (+260 net)\n' +
                'üìä NETWORK DISTRIBUTION: Visa 81.8%, Mastercard 17.7%, Discover 0.4%\n' +
                'üìä CARD TYPE BREAKDOWN: Debit 89.1% of volume, Credit 5.8%, Prepaid 5.1%\n' +
                'üìä GEOGRAPHIC CONCENTRATION: Top 5 states represent 55.8% of all transactions\n' +
                'üìä SUNBELT DOMINANCE: FL + TX = 547 transactions (30.7% of total)\n' +
                'üìä TRAFFIC PATTERN: Heavy evening/night usage (7 PM - midnight), minimal business hours\n' +
                'üìä ERROR CONCENTRATION: Top 2 error types (NSF + Fraud) = 63.4% of all failures\n' +
                'üìä AVERAGE TRANSACTION: $114.88 across all successful transactions';

            document.getElementById('additional_notes').value = 'üìù November 12, 2025 - TabaPay Baseline Performance\n\n' +
                'üéØ KEY METRICS:\n' +
                '‚Ä¢ 1,782 transactions processed\n' +
                '‚Ä¢ $168,415 total volume\n' +
                '‚Ä¢ 82.27% success rate (1,466 successful)\n' +
                '‚Ä¢ $146.60 platform revenue (0.087% effective fee)\n' +
                '‚Ä¢ $114.88 average transaction size\n\n' +
                '‚úÖ STRENGTHS:\n' +
                '‚Ä¢ Debit cards: 85.7% success (1,587 txns - 89.1% of volume)\n' +
                '‚Ä¢ Georgia: 98.61% success rate (best state)\n' +
                '‚Ä¢ California: 87.97% success rate\n' +
                '‚Ä¢ Visa dominant: 81.8% market share (1,458 txns)\n' +
                '‚Ä¢ Peak efficiency: 11 PM with 444 txns (24.9% of volume)\n\n' +
                '‚ö†Ô∏è IMPROVEMENT AREAS:\n' +
                '‚Ä¢ Overall success: 82.27% vs 90% target (-7.73pp gap)\n' +
                '‚Ä¢ Credit cards: 46.15% vs 70% target (-23.85pp gap)\n' +
                '‚Ä¢ Prepaid cards: 63.74% vs 80% target (-16.26pp gap)\n' +
                '‚Ä¢ NSF errors: 153 (49.5% of all errors) - PREVENTABLE\n' +
                '‚Ä¢ Fraud flags: 43 (13.9% of errors) - optimize rules\n\n' +
                'üó∫Ô∏è GEOGRAPHIC INSIGHTS:\n' +
                '‚Ä¢ Top 5 states: 940 txns (55.8% of geo-tagged)\n' +
                '‚Ä¢ Sunbelt concentration: FL + TX = 547 txns (30.7%)\n' +
                '‚Ä¢ High performers: GA (98.61%), TN (97.56%), CA (87.97%)\n' +
                '‚Ä¢ Need attention: IL (73.13%), NY (77.30%), FL (78.98%)\n\n' +
                'üí≥ TRANSACTION MIX:\n' +
                '‚Ä¢ Purchases: 1,021 (57.3%)\n' +
                '‚Ä¢ Disbursements: 761 (42.7%)\n' +
                '‚Ä¢ Net position: +260 (purchase-heavy)\n\n' +
                'üí∞ SIZE DISTRIBUTION:\n' +
                '‚Ä¢ Sweet spot: $10-$50 (506 txns - 34.5%)\n' +
                '‚Ä¢ Small txns: <$10 (383 txns - 26.1%)\n' +
                '‚Ä¢ Large txns: $100+ (404 txns - 27.6%)\n\n' +
                'üéØ 30-DAY ACTION PLAN:\n' +
                '1. Deploy real-time balance verification ‚Üí eliminate 153 NSF errors\n' +
                '2. Optimize fraud detection parameters ‚Üí reduce 43 false positives\n' +
                '3. Investigate credit card decline patterns ‚Üí target 70%+ success\n' +
                '4. Improve prepaid card handling ‚Üí target 80%+ success\n' +
                '5. Analyze IL/NY/FL performance ‚Üí replicate GA success (98.61%)\n' +
                '6. Overall target: 90%+ success rate within 30 days\n\n' +
                'üìä BENCHMARKS ESTABLISHED:\n' +
                'This November 12 baseline will be used to measure daily improvements.';

            // Load baseline action items
            loadActionItems([
                {
                    text: 'Deploy real-time balance verification system to eliminate 153 NSF errors (49.5% of all errors)',
                    priority: 'critical',
                    completed: false
                },
                {
                    text: 'Optimize fraud detection rules to reduce 43 false positive flags (13.9% of errors)',
                    priority: 'high',
                    completed: false
                },
                {
                    text: 'Investigate credit card decline patterns - improve from 46.15% to 70%+ success rate',
                    priority: 'high',
                    completed: false
                },
                {
                    text: 'Improve prepaid card handling - target 80%+ success rate (currently 63.74%)',
                    priority: 'high',
                    completed: false
                },
                {
                    text: 'Analyze IL, NY, and FL performance issues - replicate GA success (98.61%)',
                    priority: 'medium',
                    completed: false
                },
                {
                    text: 'Review AVS mismatch errors (22 occurrences) - improve address verification UI',
                    priority: 'medium',
                    completed: false
                },
                {
                    text: 'Monitor and optimize peak hour performance (11 PM - 444 transactions)',
                    priority: 'low',
                    completed: false
                },
                {
                    text: 'Target 90%+ overall success rate within 30 days (currently 82.27%)',
                    priority: 'critical',
                    completed: false
                }
            ]);

            calculateMetrics();
            alert('‚úÖ November 12 baseline data loaded!\n\n' +
                  '‚Ä¢ 1,782 transactions\n' +
                  '‚Ä¢ 82.27% success rate\n' +
                  '‚Ä¢ $168,415 volume\n' +
                  '‚Ä¢ All metrics populated\n\n' +
                  'Review and save to Firebase if needed.');
        }

        async function saveData(silent = false) {
            const date = document.getElementById('trackingDate').value;
            const data = {
                date: date,
                // Core metrics
                total_txns: document.getElementById('total_txns').value,
                successful_txns: document.getElementById('successful_txns').value,
                total_volume: document.getElementById('total_volume').value,
                platform_revenue: document.getElementById('platform_revenue').value,
                // Transaction mix
                purchases: document.getElementById('purchases').value,
                purchase_success_rate: document.getElementById('purchase_success_rate').value,
                disbursements: document.getElementById('disbursements').value,
                disbursement_success_rate: document.getElementById('disbursement_success_rate').value,
                // Network
                visa_txns: document.getElementById('visa_txns').value,
                visa_success: document.getElementById('visa_success').value,
                mastercard_txns: document.getElementById('mastercard_txns').value,
                mastercard_success: document.getElementById('mastercard_success').value,
                discover_txns: document.getElementById('discover_txns').value,
                discover_success: document.getElementById('discover_success').value,
                // Card types
                debit_txns: document.getElementById('debit_txns').value,
                debit_success: document.getElementById('debit_success').value,
                credit_txns: document.getElementById('credit_txns').value,
                credit_success: document.getElementById('credit_success').value,
                prepaid_txns: document.getElementById('prepaid_txns').value,
                prepaid_success: document.getElementById('prepaid_success').value,
                // Errors
                nsf_errors: document.getElementById('nsf_errors').value,
                fraud_errors: document.getElementById('fraud_errors').value,
                do_not_honor: document.getElementById('do_not_honor').value,
                avs_mismatch: document.getElementById('avs_mismatch').value,
                security_violation: document.getElementById('security_violation').value,
                // Geographic
                fl_txns: document.getElementById('fl_txns').value,
                tx_txns: document.getElementById('tx_txns').value,
                ny_txns: document.getElementById('ny_txns').value,
                ca_txns: document.getElementById('ca_txns').value,
                nc_txns: document.getElementById('nc_txns').value,
                nj_txns: document.getElementById('nj_txns').value,
                ga_txns: document.getElementById('ga_txns').value,
                il_txns: document.getElementById('il_txns').value,
                oh_txns: document.getElementById('oh_txns').value,
                tn_txns: document.getElementById('tn_txns').value,
                // Transaction sizes
                size_under_10: document.getElementById('size_under_10').value,
                size_10_50: document.getElementById('size_10_50').value,
                size_50_100: document.getElementById('size_50_100').value,
                size_100_500: document.getElementById('size_100_500').value,
                size_500_plus: document.getElementById('size_500_plus').value,
                // Traffic - Day parts
                early_morning: document.getElementById('early_morning').value,
                morning: document.getElementById('morning').value,
                afternoon: document.getElementById('afternoon').value,
                evening: document.getElementById('evening').value,
                night: document.getElementById('night').value,
                peak_hour: document.getElementById('peak_hour').value,
                peak_volume: document.getElementById('peak_volume').value,
                // Traffic - Channels
                mobile_app: document.getElementById('mobile_app').value,
                web_portal: document.getElementById('web_portal').value,
                api_direct: document.getElementById('api_direct').value,
                // Traffic - Devices
                ios_txns: document.getElementById('ios_txns').value,
                ios_success: document.getElementById('ios_success').value,
                android_txns: document.getElementById('android_txns').value,
                android_success: document.getElementById('android_success').value,
                desktop_txns: document.getElementById('desktop_txns').value,
                desktop_success: document.getElementById('desktop_success').value,
                // Growth
                daily_optins: document.getElementById('daily_optins').value,
                mtd_optins: document.getElementById('mtd_optins').value,
                new_users: document.getElementById('new_users').value,
                unique_users: document.getElementById('unique_users').value,
                repeat_rate: document.getElementById('repeat_rate').value,
                // Notes
                key_wins: document.getElementById('key_wins').value,
                blockers: document.getElementById('blockers').value,
                observations: document.getElementById('observations').value,
                additional_notes: document.getElementById('additional_notes').value,
                // Action items
                action_items: (() => {
                    const items = [];
                    document.querySelectorAll('.action-item').forEach(item => {
                        const id = item.id;
                        items.push({
                            text: document.getElementById(id + '-text').value,
                            priority: document.getElementById(id + '-priority').value,
                            completed: document.getElementById(id + '-check').checked
                        });
                    });
                    return items;
                })()
            };

            localStorage.setItem('bambu_pay_tracker_' + date, JSON.stringify(data));
            const success = await window.saveToFirebase(data, date);

            if (!silent) {
                alert(success ? '‚úÖ Data saved successfully!' : '‚ö†Ô∏è Saved locally only');
            }
            return success;
        }

        async function loadData() {
            const date = document.getElementById('trackingDate').value;
            const firebaseData = await window.loadFromFirebase(date);

            let data = firebaseData || JSON.parse(localStorage.getItem('bambu_pay_tracker_' + date) || 'null');

            if (!data) {
                alert('üì≠ No saved data found for ' + date);
                return;
            }

            Object.keys(data).forEach(key => {
                if (key === 'action_items') {
                    loadActionItems(data[key]);
                } else {
                    const element = document.getElementById(key);
                    if (element) element.value = data[key];
                }
            });

            calculateMetrics();
            alert('‚úÖ Data loaded for ' + date);
        }

        async function onDateChange() {
            const date = document.getElementById('trackingDate').value;
            const data = await window.loadFromFirebase(date) ||
                         JSON.parse(localStorage.getItem('bambu_pay_tracker_' + date) || 'null');

            if (data) {
                Object.keys(data).forEach(key => {
                    if (key === 'action_items') {
                        loadActionItems(data[key]);
                    } else {
                        const element = document.getElementById(key);
                        if (element) element.value = data[key];
                    }
                });
                calculateMetrics();
            } else {
                // No data for this date, load default action items
                loadActionItems([]);
            }
        }

        function clearAll() {
            if (confirm('Clear all fields?')) {
                document.querySelectorAll('input[type="number"], input[type="text"], textarea').forEach(el => {
                    if (!el.readOnly) el.value = '';
                });
                // Clear action items
                document.getElementById('action-items-container').innerHTML = '';
                loadActionItems([]);
                calculateMetrics();
            }
        }

        function exportToCSV() {
            alert('CSV export feature coming soon!');
        }

        // Real-time autosave with visual feedback
        let autosaveTimer;
        let isSaving = false;

        async function triggerRealtimeSave() {
            if (isSaving) return; // Prevent overlapping saves

            const statusEl = document.getElementById('autosave-status');
            statusEl.textContent = 'üíæ Saving...';
            statusEl.style.color = '#667eea';
            statusEl.classList.add('saving-pulse');

            isSaving = true;
            const success = await saveData(true);
            isSaving = false;

            statusEl.classList.remove('saving-pulse');

            if (success) {
                statusEl.textContent = '‚úÖ Saved to Firebase';
                statusEl.style.color = '#10b981';
                statusEl.style.fontWeight = '700';
            } else {
                statusEl.textContent = '‚ö†Ô∏è Save Failed';
                statusEl.style.color = '#ef4444';
                statusEl.style.fontWeight = '700';
            }

            // Reset status after 2 seconds
            setTimeout(() => {
                statusEl.textContent = 'üîÑ Real-time sync enabled';
                statusEl.style.color = '#667eea';
                statusEl.style.fontWeight = '600';
            }, 2000);
        }

        // Attach real-time autosave to all inputs
        document.querySelectorAll('input, textarea').forEach(input => {
            input.addEventListener('input', () => {
                // Clear existing timer
                clearTimeout(autosaveTimer);

                // Save after 500ms of no typing (real-time feel)
                autosaveTimer = setTimeout(() => {
                    triggerRealtimeSave();
                }, 500);
            });
        });

        // Action Items Management
        let actionItemCounter = 0;

        function addActionItem(text = '', priority = 'medium', completed = false) {
            const container = document.getElementById('action-items-container');
            const itemId = 'action-item-' + (++actionItemCounter);

            const itemDiv = document.createElement('div');
            itemDiv.id = itemId;
            itemDiv.className = 'action-item';
            itemDiv.style.cssText = 'background: white; padding: 15px; border-radius: 8px; margin-bottom: 12px; border: 2px solid #e5e7eb; display: flex; align-items: start; gap: 12px;';

            itemDiv.innerHTML = `
                <input type="checkbox" id="${itemId}-check" ${completed ? 'checked' : ''} onchange="toggleActionItem('${itemId}')"
                    style="width: 20px; height: 20px; margin-top: 3px; cursor: pointer;">
                <div style="flex: 1;">
                    <div style="display: flex; gap: 10px; margin-bottom: 8px; align-items: center;">
                        <select id="${itemId}-priority" onchange="updateActionItem('${itemId}')"
                            style="padding: 5px 10px; border: 2px solid #d1d5db; border-radius: 5px; font-size: 0.9em; cursor: pointer;">
                            <option value="low" ${priority === 'low' ? 'selected' : ''}>üü¢ Low</option>
                            <option value="medium" ${priority === 'medium' ? 'selected' : ''}>üü° Medium</option>
                            <option value="high" ${priority === 'high' ? 'selected' : ''}>üî¥ High</option>
                            <option value="critical" ${priority === 'critical' ? 'selected' : ''}>üö® Critical</option>
                        </select>
                        <button onclick="removeActionItem('${itemId}')"
                            style="padding: 5px 12px; background: #ef4444; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9em;">
                            üóëÔ∏è Remove
                        </button>
                    </div>
                    <textarea id="${itemId}-text" placeholder="Describe the action item..."
                        oninput="updateActionItem('${itemId}')"
                        style="width: 100%; padding: 10px; border: 2px solid #d1d5db; border-radius: 5px; min-height: 60px; font-family: inherit; font-size: 0.95em;">${text}</textarea>
                </div>
            `;

            container.appendChild(itemDiv);

            if (completed) {
                toggleActionItem(itemId, false);
            }
        }

        function toggleActionItem(itemId, triggerSave = true) {
            const checkbox = document.getElementById(itemId + '-check');
            const textarea = document.getElementById(itemId + '-text');
            const item = document.getElementById(itemId);

            if (checkbox.checked) {
                textarea.style.textDecoration = 'line-through';
                textarea.style.opacity = '0.6';
                item.style.background = '#f3f4f6';
                item.style.borderColor = '#10b981';
            } else {
                textarea.style.textDecoration = 'none';
                textarea.style.opacity = '1';
                item.style.background = 'white';
                item.style.borderColor = '#e5e7eb';
            }

            if (triggerSave) {
                saveActionItems();
            }
        }

        function removeActionItem(itemId) {
            if (confirm('Remove this action item?')) {
                document.getElementById(itemId).remove();
                saveActionItems();
            }
        }

        function updateActionItem(itemId) {
            saveActionItems();
        }

        function saveActionItems() {
            const items = [];
            document.querySelectorAll('.action-item').forEach(item => {
                const id = item.id;
                items.push({
                    text: document.getElementById(id + '-text').value,
                    priority: document.getElementById(id + '-priority').value,
                    completed: document.getElementById(id + '-check').checked
                });
            });

            localStorage.setItem('action_items_temp', JSON.stringify(items));

            // Trigger real-time save
            clearTimeout(autosaveTimer);
            autosaveTimer = setTimeout(() => {
                triggerRealtimeSave();
            }, 500);
        }

        function loadActionItems(items) {
            document.getElementById('action-items-container').innerHTML = '';
            actionItemCounter = 0;

            if (items && items.length > 0) {
                items.forEach(item => {
                    addActionItem(item.text, item.priority, item.completed);
                });
            } else {
                // Add default action items
                addActionItem('Review error patterns and implement fixes', 'high', false);
                addActionItem('Monitor success rate progress toward 90% target', 'medium', false);
                addActionItem('Analyze card type performance trends', 'medium', false);
            }
        }

        // Auto-save Nov 12 baseline to Firebase
        async function ensureNov12BaselineInFirebase() {
            const nov12Date = '2025-11-12';

            // Check if Nov 12 data already exists in Firebase
            const existing = await window.loadFromFirebase(nov12Date);

            if (!existing) {
                console.log('Nov 12 baseline not found in Firebase, saving now...');

                // Temporarily set date to Nov 12
                const currentDate = document.getElementById('trackingDate').value;
                document.getElementById('trackingDate').value = nov12Date;

                // Load all the baseline data
                document.getElementById('total_txns').value = '1782';
                document.getElementById('successful_txns').value = '1466';
                document.getElementById('total_volume').value = '168415';
                document.getElementById('platform_revenue').value = '146.60';
                document.getElementById('purchases').value = '1021';
                document.getElementById('disbursements').value = '761';
                document.getElementById('visa_txns').value = '1458';
                document.getElementById('mastercard_txns').value = '316';
                document.getElementById('discover_txns').value = '8';
                document.getElementById('debit_txns').value = '1587';
                document.getElementById('debit_success').value = '85.7';
                document.getElementById('credit_txns').value = '104';
                document.getElementById('credit_success').value = '46.15';
                document.getElementById('prepaid_txns').value = '91';
                document.getElementById('prepaid_success').value = '63.74';
                document.getElementById('nsf_errors').value = '153';
                document.getElementById('fraud_errors').value = '43';
                document.getElementById('do_not_honor').value = '27';
                document.getElementById('avs_mismatch').value = '22';
                document.getElementById('security_violation').value = '13';
                document.getElementById('fl_txns').value = '295';
                document.getElementById('tx_txns').value = '252';
                document.getElementById('ny_txns').value = '163';
                document.getElementById('ca_txns').value = '158';
                document.getElementById('nc_txns').value = '79';
                document.getElementById('nj_txns').value = '72';
                document.getElementById('ga_txns').value = '72';
                document.getElementById('il_txns').value = '67';
                document.getElementById('oh_txns').value = '54';
                document.getElementById('tn_txns').value = '41';
                document.getElementById('peak_hour').value = '11 PM';
                document.getElementById('peak_volume').value = '444';
                document.getElementById('size_under_10').value = '383';
                document.getElementById('size_10_50').value = '506';
                document.getElementById('size_50_100').value = '173';
                document.getElementById('size_100_500').value = '277';
                document.getElementById('size_500_plus').value = '127';

                document.getElementById('key_wins').value = '‚úÖ Processed 1,782 transactions totaling $168,415\n' +
                    '‚úÖ Strong debit card performance: 85.7% success rate (1,587 cards)\n' +
                    '‚úÖ Georgia state excellence: 98.61% success rate (72 transactions)\n' +
                    '‚úÖ California performance: 87.97% success rate (158 transactions)\n' +
                    '‚úÖ Visa network dominance: 81.8% market share (1,458 transactions)\n' +
                    '‚úÖ Peak efficiency: 11 PM with 444 transactions (24.9% of daily volume)\n' +
                    '‚úÖ Transaction volume sweet spot: $10-$50 range (506 txns - 34.5%)';

                document.getElementById('blockers').value = '‚ö†Ô∏è Overall success rate at 82.27% vs 90% target (-7.73pp gap)\n' +
                    '‚ö†Ô∏è Credit card success critically low: 46.15% vs 70% target (-23.85pp)\n' +
                    '‚ö†Ô∏è Prepaid card success below target: 63.74% vs 80% target (-16.26pp)\n' +
                    '‚ö†Ô∏è High NSF error rate: 153 errors (49.5% of all failures)\n' +
                    '‚ö†Ô∏è Fraud detection false positives: 43 legitimate transactions flagged\n' +
                    '‚ö†Ô∏è Geographic performance gaps: IL (73.13%), NY (77.30%), FL (78.98%)';

                document.getElementById('observations').value = 'üìä TRANSACTION MIX: Purchase-heavy day with 1,021 purchases vs 761 disbursements (+260 net)\n' +
                    'üìä NETWORK DISTRIBUTION: Visa 81.8%, Mastercard 17.7%, Discover 0.4%\n' +
                    'üìä CARD TYPE BREAKDOWN: Debit 89.1% of volume, Credit 5.8%, Prepaid 5.1%\n' +
                    'üìä GEOGRAPHIC CONCENTRATION: Top 5 states represent 55.8% of all transactions\n' +
                    'üìä SUNBELT DOMINANCE: FL + TX = 547 transactions (30.7% of total)\n' +
                    'üìä TRAFFIC PATTERN: Heavy evening/night usage (7 PM - midnight), minimal business hours\n' +
                    'üìä ERROR CONCENTRATION: Top 2 error types (NSF + Fraud) = 63.4% of all failures\n' +
                    'üìä AVERAGE TRANSACTION: $114.88 across all successful transactions';

                document.getElementById('additional_notes').value = 'üìù November 12, 2025 - TabaPay Baseline Performance\n\n' +
                    'This baseline has been automatically saved to Firebase for future reference and comparison.';

                // Calculate metrics
                calculateMetrics();

                // Save to Firebase
                const saved = await saveData(true);

                if (saved) {
                    console.log('‚úÖ Nov 12 baseline successfully saved to Firebase');
                } else {
                    console.error('‚ùå Failed to save Nov 12 baseline to Firebase');
                }

                // Restore original date
                document.getElementById('trackingDate').value = currentDate;
                await onDateChange();
            } else {
                console.log('‚úÖ Nov 12 baseline already exists in Firebase');
            }
        }

        // Auto-load on page load
        window.addEventListener('load', async function() {
            // First, ensure Nov 12 baseline is in Firebase
            await ensureNov12BaselineInFirebase();

            // Then load current date data
            await onDateChange();

            // Load temp action items if they exist
            const tempItems = localStorage.getItem('action_items_temp');
            if (tempItems) {
                loadActionItems(JSON.parse(tempItems));
            } else {
                loadActionItems([]);
            }
        });
    </script>
</body>
</html>
